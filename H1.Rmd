---
title: "H1"
output: html_document
date: '2022-04-10'
---

```{r include=FALSE}
#import libraries
install.packages("dplyr")
install.packages("tidyr")
install.packages("matrixcalc")
install.packages("zoo")
library(dplyr)
library(tidyr)
library(matrixcalc)
library(zoo)

```
Power consumption in USA:

The exercise deals with data from power stations in the United States on several contracts.

info cell: Reading the table Data

```{r}
#Reading Data
A <- read.delim("table.tsv")
A$DateTime <- as.POSIXct( A$megawatthours, tz = "EST", "%H:%M EST %m/%d/%Y" )

```
Data clearing:

1.Remove duplicate rows in the data frame

2.Complete missing values according to Last Observation in data frame

```{r}
A<-distinct(A) #1
na.locf(na.locf(A),fromLast=TRUE) #2
```
Cube construction:

The cube is bulid from dimension of time by days and the dimension of stations.

The measurable variable is Net generation
```{r}
# The dimensions of the cube are the Power stations and the dimension of date time.
data_cube<- with(A,cbind(BPAT=Net.generation,CISO	=Net.generation.1, CPLE=Net.generation.2,ERCO= Net.generation.3, FPL=Net.generation.4,ISNE= Net.generation.5,MISO= Net.generation.6,
                         NYIS =Net.generation.7 , PACW=Net.generation.8 , PJM=Net.generation.9 ,United_States_Lower = Net.generation.10,Date=as.integer(format(as.Date(A[,'DateTime']), "%Y%m%d"))))
```
Slicing:

Performing Slicing on Data cube, from all days to 07-14 Feb only.

```{r}
index<-which(as.Date(A[,'DateTime'], tz = "EST", "%Y%m%d")>as.character.POSIXt("2021-02-06") & as.Date(A[,'DateTime'], tz = "EST","%m%d%Y")<as.character.POSIXt("2021-02-15") )
Silce_cube<-data_cube[index,]
```
Roll up:

Performing roll up - from a days and hours to days only.

```{r}
temp<-data_cube[index,]
rownames(temp) <- c(temp[,"Date"])
temp<-temp[,colnames(temp)!="Date"]
roll_up <-  rowsum(temp,row.names(temp))
data_mean<-rowMeans(roll_up[,1:11]) #Daily average performance
```
Plot:

Axis x - days

Axis y- Net generation

A graph that shows the daily average of the Net generation in the US


```{r}
data_frame<-tibble(data_mean)
days<- as.integer(substr(names(roll_up[,1]), nchar(names(roll_up[,1])) - 2 + 1, nchar(names(roll_up[,1]))) )
# create an empty plot
plot(1, type="n", xlab="", ylab="", xlim = c(days[1],days[8]), ylim=c(1505748 ,1900000 ))
# rearrange in a new, temporary dataframe
DF <- data.frame ( Time = days, Demand = data_frame)
# plot
lines( DF, col = 'darkorchid1', type = 'b' )
title(main = "Mean daily power generation in the US",
      xlab = "Days (07-14 Feb)", ylab = "Net generation",
      cex.main = 2,   font.main = 2, col.main = "darkorchid1")
```

